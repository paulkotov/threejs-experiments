<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Day 9: Post-Processing & Cinematic Effects</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <!-- Day 9 Info Panel -->
  <div class="info-panel">
    <h1>üé¨ Day 9: Post-Processing & Effects</h1>
    <p><strong>Concept:</strong> Cinematic Visual Polish & Atmosphere</p>
    <p><strong>Skills:</strong> Fog ¬∑ Glow ¬∑ Atmosphere ¬∑ Depth</p>
    <div class="effect-info">
      <p><strong>üé® Active Effects:</strong></p>
      <ul>
        <li id="fog-status">‚úì Exponential Fog</li>
        <li id="glow-status">‚úì Emissive Glow</li>
        <li>‚úì Depth-based coloring</li>
        <li>‚úì Atmospheric lighting</li>
        <li>‚úì Cinematic camera angle</li>
      </ul>
    </div>
    <div class="controls-info">
      <p><strong>‚å®Ô∏è Keyboard Controls:</strong></p>
      <ul>
        <li><kbd>F</kbd> - Toggle fog</li>
        <li><kbd>G</kbd> - Toggle glow</li>
        <li><kbd>+</kbd> / <kbd>-</kbd> - Fog density</li>
        <li><kbd>1</kbd>-<kbd>4</kbd> - Preset camera angles</li>
        <li><kbd>C</kbd> - Cycle background colors</li>
        <li><kbd>Space</kbd> - Pause/Resume animation</li>
      </ul>
      <p><strong>üñ±Ô∏è Mouse:</strong> Drag to rotate ¬∑ Scroll to zoom</p>
    </div>
  </div>

  <!-- ThreeJS Core Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  
  <!-- OrbitControls -->
  <script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>

  <!-- Day 9 Script -->
  <script>
    // ========================================
    // DAY 9: POST-PROCESSING & CINEMATIC EFFECTS
    // Learning: Fog, Atmosphere, Depth, Glow, Camera
    // ========================================

    console.log('üé¨ Day 9: Post-Processing & Cinematic Effects');
    console.log('Building cinematic scene...');

    // SCENE SETUP
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x050510);

    // FOG - Creates depth and atmosphere
    scene.fog = new THREE.FogExp2(0x050510, 0.015);

    // CAMERA
    const camera = new THREE.PerspectiveCamera(
      60,  // Narrower FOV for cinematic feel
      window.innerWidth / window.innerHeight,
      0.1,
      1000
    );
    camera.position.set(0, 15, 40);

    // RENDERER
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    document.body.appendChild(renderer.domElement);

    // ORBIT CONTROLS
    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;
    controls.minDistance = 10;
    controls.maxDistance = 100;

    // ========================================
    // LIGHTING - Atmospheric Setup
    // ========================================

    // Ambient light - low intensity for mood
    const ambientLight = new THREE.AmbientLight(0x4488ff, 0.2);
    scene.add(ambientLight);

    // Main directional light
    const mainLight = new THREE.DirectionalLight(0xffffff, 0.6);
    mainLight.position.set(10, 20, 10);
    mainLight.castShadow = true;
    mainLight.shadow.mapSize.width = 2048;
    mainLight.shadow.mapSize.height = 2048;
    scene.add(mainLight);

    // Rim light (back light for depth)
    const rimLight = new THREE.DirectionalLight(0xff8844, 0.3);
    rimLight.position.set(-10, 5, -10);
    scene.add(rimLight);

    // Point lights for atmosphere
    const pointLight1 = new THREE.PointLight(0x4488ff, 1, 50);
    pointLight1.position.set(15, 10, 15);
    scene.add(pointLight1);

    const pointLight2 = new THREE.PointLight(0xff4488, 1, 50);
    pointLight2.position.set(-15, 10, -15);
    scene.add(pointLight2);

    // ========================================
    // CREATE SCENE OBJECTS
    // ========================================

    // Central glowing sphere
    const centralGeo = new THREE.SphereGeometry(3, 32, 32);
    const centralMat = new THREE.MeshStandardMaterial({
      color: 0x6688ff,
      emissive: 0x4466ff,
      emissiveIntensity: 0.5,
      metalness: 0.8,
      roughness: 0.2
    });
    const centralSphere = new THREE.Mesh(centralGeo, centralMat);
    centralSphere.position.y = 5;
    centralSphere.castShadow = true;
    scene.add(centralSphere);

    // Orbiting objects with different emissive properties
    const orbitObjects = [];
    const orbitRadius = 15;
    const objectCount = 8;

    for (let i = 0; i < objectCount; i++) {
      const angle = (i / objectCount) * Math.PI * 2;
      
      const geo = new THREE.BoxGeometry(2, 2, 2);
      const mat = new THREE.MeshStandardMaterial({
        color: new THREE.Color().setHSL(i / objectCount, 0.7, 0.5),
        emissive: new THREE.Color().setHSL(i / objectCount, 0.7, 0.3),
        emissiveIntensity: 0.3,
        metalness: 0.6,
        roughness: 0.4
      });
      
      const mesh = new THREE.Mesh(geo, mat);
      mesh.position.x = Math.cos(angle) * orbitRadius;
      mesh.position.z = Math.sin(angle) * orbitRadius;
      mesh.position.y = 2;
      mesh.castShadow = true;
      mesh.receiveShadow = true;
      
      scene.add(mesh);
      orbitObjects.push({ mesh, angle, radius: orbitRadius });
    }

    // Ground plane
    const planeGeo = new THREE.PlaneGeometry(100, 100);
    const planeMat = new THREE.MeshStandardMaterial({
      color: 0x222244,
      roughness: 0.8,
      metalness: 0.2
    });
    const plane = new THREE.Mesh(planeGeo, planeMat);
    plane.rotation.x = -Math.PI / 2;
    plane.receiveShadow = true;
    scene.add(plane);

    // Grid for depth perception
    const gridHelper = new THREE.GridHelper(100, 50, 0x444466, 0x222233);
    gridHelper.material.opacity = 0.3;
    gridHelper.material.transparent = true;
    scene.add(gridHelper);

    // Atmospheric particles
    const particleGeo = new THREE.BufferGeometry();
    const particleCount = 1000;
    const particlePositions = [];

    for (let i = 0; i < particleCount; i++) {
      particlePositions.push(
        (Math.random() - 0.5) * 100,
        Math.random() * 50,
        (Math.random() - 0.5) * 100
      );
    }

    particleGeo.setAttribute('position', new THREE.Float32BufferAttribute(particlePositions, 3));
    
    const particleMat = new THREE.PointsMaterial({
      size: 0.1,
      color: 0x8899ff,
      transparent: true,
      opacity: 0.6,
      blending: THREE.AdditiveBlending,
      depthWrite: false
    });
    
    const particles = new THREE.Points(particleGeo, particleMat);
    scene.add(particles);

    // ========================================
    // STATE VARIABLES
    // ========================================

    let isPaused = false;
    let fogEnabled = true;
    let glowEnabled = true;
    let bgColorIndex = 0;
    let fogDensity = 0.015;
    const clock = new THREE.Clock();

    const bgColors = [
      0x050510,  // Dark blue-purple
      0x0a0505,  // Dark red
      0x050a05,  // Dark green
      0x0a0a05   // Dark yellow
    ];

    // ========================================
    // CAMERA PRESETS
    // ========================================

    const cameraPresets = [
      { pos: [0, 15, 40], target: [0, 5, 0], name: 'Overview' },
      { pos: [30, 10, 30], target: [0, 5, 0], name: 'Side angle' },
      { pos: [0, 3, 20], target: [0, 5, 0], name: 'Low angle' },
      { pos: [0, 40, 1], target: [0, 0, 0], name: 'Top-down' }
    ];

    function setCameraPreset(index) {
      const preset = cameraPresets[index];
      camera.position.set(...preset.pos);
      controls.target.set(...preset.target);
      controls.update();
      console.log(`üì∏ Camera: ${preset.name}`);
    }

    // ========================================
    // KEYBOARD CONTROLS
    // ========================================

    window.addEventListener('keydown', (event) => {
      switch(event.key) {
        case ' ':
          isPaused = !isPaused;
          console.log(isPaused ? '‚è∏Ô∏è Animation paused' : '‚ñ∂Ô∏è Animation resumed');
          break;
        case 'f':
        case 'F':
          fogEnabled = !fogEnabled;
          scene.fog = fogEnabled ? new THREE.FogExp2(scene.background.getHex(), fogDensity) : null;
          document.getElementById('fog-status').textContent = fogEnabled ? '‚úì Exponential Fog' : '‚úó Fog (disabled)';
          console.log(`üå´Ô∏è Fog: ${fogEnabled ? 'ON' : 'OFF'}`);
          break;
        case 'g':
        case 'G':
          glowEnabled = !glowEnabled;
          const intensity = glowEnabled ? 0.5 : 0;
          centralMat.emissiveIntensity = intensity;
          orbitObjects.forEach(obj => {
            obj.mesh.material.emissiveIntensity = glowEnabled ? 0.3 : 0;
          });
          document.getElementById('glow-status').textContent = glowEnabled ? '‚úì Emissive Glow' : '‚úó Glow (disabled)';
          console.log(`‚ú® Glow: ${glowEnabled ? 'ON' : 'OFF'}`);
          break;
        case '+':
        case '=':
          fogDensity = Math.min(fogDensity + 0.005, 0.05);
          if (fogEnabled) scene.fog.density = fogDensity;
          console.log(`üå´Ô∏è Fog density: ${fogDensity.toFixed(3)}`);
          break;
        case '-':
        case '_':
          fogDensity = Math.max(fogDensity - 0.005, 0.001);
          if (fogEnabled) scene.fog.density = fogDensity;
          console.log(`üå´Ô∏è Fog density: ${fogDensity.toFixed(3)}`);
          break;
        case '1':
          setCameraPreset(0);
          break;
        case '2':
          setCameraPreset(1);
          break;
        case '3':
          setCameraPreset(2);
          break;
        case '4':
          setCameraPreset(3);
          break;
        case 'c':
        case 'C':
          bgColorIndex = (bgColorIndex + 1) % bgColors.length;
          const newBg = bgColors[bgColorIndex];
          scene.background.setHex(newBg);
          if (fogEnabled) scene.fog.color.setHex(newBg);
          console.log(`üé® Background changed`);
          break;
      }
    });

    // ========================================
    // ANIMATION LOOP
    // ========================================

    function animate() {
      requestAnimationFrame(animate);

      const delta = clock.getDelta();
      const elapsed = clock.getElapsedTime();

      if (!isPaused) {
        // Rotate central sphere
        centralSphere.rotation.y += delta * 0.5;
        centralSphere.rotation.x = Math.sin(elapsed * 0.3) * 0.3;

        // Pulsing glow effect
        if (glowEnabled) {
          centralMat.emissiveIntensity = 0.5 + Math.sin(elapsed * 2) * 0.2;
        }

        // Orbit objects around center
        orbitObjects.forEach((obj, i) => {
          obj.angle += delta * 0.3 * (1 + i * 0.1);
          obj.mesh.position.x = Math.cos(obj.angle) * obj.radius;
          obj.mesh.position.z = Math.sin(obj.angle) * obj.radius;
          obj.mesh.position.y = 2 + Math.sin(obj.angle * 2 + i) * 1.5;
          obj.mesh.rotation.x += delta * (1 + i * 0.2);
          obj.mesh.rotation.y += delta * (1 + i * 0.1);
        });

        // Animate point lights
        pointLight1.position.x = Math.cos(elapsed * 0.5) * 20;
        pointLight1.position.z = Math.sin(elapsed * 0.5) * 20;

        pointLight2.position.x = Math.cos(elapsed * 0.5 + Math.PI) * 20;
        pointLight2.position.z = Math.sin(elapsed * 0.5 + Math.PI) * 20;

        // Slowly drift particles
        particles.rotation.y += delta * 0.05;
      }

      // Update controls
      controls.update();

      // Render
      renderer.render(scene, camera);
    }

    animate();

    // ========================================
    // WINDOW RESIZE
    // ========================================

    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    });

    // ========================================
    // CONSOLE INFO
    // ========================================

    console.log('');
    console.log('üìö What you\'re learning:');
    console.log('  ‚úì Fog - Depth-based atmospheric effect');
    console.log('  ‚úì FogExp2 - Exponential fog density');
    console.log('  ‚úì Emissive materials - Self-illumination/glow');
    console.log('  ‚úì Atmospheric lighting - Multiple colored lights');
    console.log('  ‚úì Depth perception - Visual depth cues');
    console.log('  ‚úì Cinematic composition - Camera angles and FOV');
    console.log('  ‚úì Visual polish - Combined effects for atmosphere');
    console.log('');
    console.log('üéÆ Try these:');
    console.log('  F: Toggle fog on/off - see how it adds depth');
    console.log('  +/-: Adjust fog density');
    console.log('  G: Toggle glow - notice the emissive effect');
    console.log('  1-4: Different camera angles');
    console.log('  C: Change atmosphere color');
    console.log('');
    console.log('üí° Post-Processing Concepts:');
    console.log('  Note: This demo shows built-in effects.');
    console.log('  Advanced post-processing uses EffectComposer:');
    console.log('    - Bloom (glow from bright areas)');
    console.log('    - DOF (depth of field blur)');
    console.log('    - SSAO (ambient occlusion)');
    console.log('    - Color grading');
    console.log('  Check DAY_09_GUIDE.md for full explanation!');
  </script>
</body>

</html>
